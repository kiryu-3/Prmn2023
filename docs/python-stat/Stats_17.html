<!DOCTYPE html>
<html>
<head>
<title>Stats_17.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="%E5%88%86%E6%95%A3%E5%88%86%E6%9E%902">分散分析2</h1>
<ul>
<li><a href="#%E5%88%86%E6%95%A3%E5%88%86%E6%9E%902">分散分析2</a>
<ul>
<li><a href="#%E5%88%86%E6%95%A3%E5%88%86%E6%9E%90%E3%81%A8%E3%81%AF%E5%86%8D%E6%8E%B2">分散分析とは（再掲）</a>
<ul>
<li><a href="#%E5%9F%BA%E6%9C%AC%E7%94%A8%E8%AA%9E%E5%86%8D%E6%8E%B2">基本用語（再掲）</a></li>
<li><a href="#%E5%88%86%E6%95%A3%E5%88%86%E6%9E%90%E3%81%AE%E7%A8%AE%E9%A1%9E%E5%86%8D%E6%8E%B2">分散分析の種類（再掲）</a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C%E5%85%83%E9%85%8D%E7%BD%AE%E5%88%86%E6%95%A3%E5%88%86%E6%9E%90">二元配置分散分析</a>
<ul>
<li><a href="#%E5%88%86%E6%95%A3%E5%88%86%E6%9E%90%E8%A1%A8">分散分析表</a></li>
<li><a href="#%E6%BC%94%E7%BF%92">演習</a></li>
<li><a href="#%E4%BB%AE%E8%AA%AC%E6%A4%9C%E5%AE%9A%E3%81%AE%E3%82%B9%E3%83%86%E3%83%83%E3%83%97%E5%86%8D%E6%8E%B2">仮説検定のステップ（再掲）</a>
<ul>
<li><a href="#%E5%B8%B0%E7%84%A1%E4%BB%AE%E8%AA%AC%E3%81%A8%E5%AF%BE%E7%AB%8B%E4%BB%AE%E8%AA%AC%E3%82%92%E7%AB%8B%E3%81%A6%E3%82%8B">帰無仮説と対立仮説を立てる</a></li>
<li><a href="#%E5%B8%B0%E7%84%A1%E4%BB%AE%E8%AA%AC%E3%81%AE%E3%82%82%E3%81%A8%E3%81%A7%E6%A8%99%E6%9C%AC%E8%A6%B3%E5%AF%9F%E3%82%92%E8%A1%8C%E3%81%86">帰無仮説のもとで標本観察を行う</a>
<ul>
<li><a href="#%E5%85%A8%E4%BD%93%E5%B9%B3%E5%9D%87%E3%81%A8%E5%90%84%E7%BE%A4%E3%81%AE%E5%B9%B3%E5%9D%87%E5%80%A4%E3%81%AE%E5%B0%8E%E5%87%BA">全体平均と各群の平均値の導出</a></li>
<li><a href="#%E5%85%A8%E4%BD%93%E5%B9%B3%E5%9D%87%E3%81%8B%E3%82%89%E5%90%84%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E3%82%BA%E3%83%AC">全体平均から各データのズレ</a></li>
<li><a href="#%E5%85%A8%E4%BD%93%E5%B9%B3%E5%9D%87%E3%81%8B%E3%82%89%E5%90%84%E7%BE%A4%E3%81%AE%E5%B9%B3%E5%9D%87%E5%80%A4%E3%81%AE%E3%82%BA%E3%83%AC">全体平均から各群の平均値のズレ</a></li>
<li><a href="#%E4%BA%A4%E4%BA%92%E4%BD%9C%E7%94%A8%E3%81%AE%E5%B9%B3%E6%96%B9%E5%92%8C">交互作用の平方和</a></li>
<li><a href="#%E6%AE%8B%E5%B7%AE%E3%81%AE%E5%B9%B3%E6%96%B9%E5%92%8C">残差の平方和</a></li>
<li><a href="#%E8%87%AA%E7%94%B1%E5%BA%A6%E3%81%8B%E3%82%89%E5%B9%B3%E5%9D%87%E5%B9%B3%E6%96%B9">自由度から平均平方</a></li>
<li><a href="#%E7%B5%B1%E8%A8%88%E9%87%8Ff">統計量$F$</a></li>
</ul>
</li>
<li><a href="#%E5%B8%B0%E7%84%A1%E4%BB%AE%E8%AA%AC%E3%82%92%E6%A3%84%E5%8D%B4%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%8B%E3%81%A9%E3%81%86%E3%81%8B%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B">帰無仮説を棄却できるかどうかを確認する</a>
<ul>
<li><a href="#%E8%82%A5%E6%96%99%E3%81%AE%E9%87%8F%E3%81%AEf%E6%A4%9C%E5%AE%9A">肥料の量の$F$検定</a></li>
<li><a href="#%E5%9C%9F%E3%81%AE%E7%A8%AE%E9%A1%9E%E3%81%AEf%E6%A4%9C%E5%AE%9A">土の種類の$F$検定</a></li>
<li><a href="#%E4%BA%A4%E4%BA%92%E4%BD%9C%E7%94%A8%E3%81%AEf%E6%A4%9C%E5%AE%9A">交互作用の$F$検定</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#python%E3%81%AB%E3%82%88%E3%82%8B%E4%BA%8C%E5%85%83%E9%85%8D%E7%BD%AE%E5%88%86%E6%95%A3%E5%88%86%E6%9E%90">Pythonによる二元配置分散分析</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<pre class="hljs"><code><div><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
!pip install japanize-matplotlib
<span class="hljs-keyword">import</span> japanize_matplotlib
<span class="hljs-keyword">from</span> scipy <span class="hljs-keyword">import</span> stats
<span class="hljs-keyword">from</span> statsmodels.formula.api <span class="hljs-keyword">import</span> ols
<span class="hljs-keyword">import</span> statsmodels.formula.api <span class="hljs-keyword">as</span> smf
<span class="hljs-keyword">import</span> statsmodels.api <span class="hljs-keyword">as</span> sm
<span class="hljs-keyword">from</span> statsmodels.stats.multicomp <span class="hljs-keyword">import</span> pairwise_tukeyhsd
<span class="hljs-keyword">from</span> statsmodels.graphics.factorplots <span class="hljs-keyword">import</span> interaction_plot
<span class="hljs-keyword">from</span> statsmodels.stats.anova <span class="hljs-keyword">import</span> anova_lm
<span class="hljs-keyword">import</span> statsmodels.api <span class="hljs-keyword">as</span> sm
<span class="hljs-keyword">from</span> scipy.stats <span class="hljs-keyword">import</span> f
<span class="hljs-keyword">from</span> decimal <span class="hljs-keyword">import</span> Decimal, ROUND_HALF_UP, ROUND_HALF_EVEN
</div></code></pre>
<div style="page-break-before:always"></div>
<h2 id="%E5%88%86%E6%95%A3%E5%88%86%E6%9E%90%E3%81%A8%E3%81%AF%E5%86%8D%E6%8E%B2">分散分析とは（再掲）</h2>
<p>平均値の差の検定において、3群以上からなるデータに対しては<br>
（推定の多重性のため）$t$検定を行うことができません。</p>
<p>このような場合にも対応できる、<br>
「分散の比」を考えて平均値の差を検定する分析手法を<strong>分散分析</strong>といいます。</p>
<h3 id="%E5%9F%BA%E6%9C%AC%E7%94%A8%E8%AA%9E%E5%86%8D%E6%8E%B2">基本用語（再掲）</h3>
<ul>
<li><strong>要因</strong>：データの値に変化を与える要素のこと</li>
<li><strong>因子</strong>：要因の中でも特に、母平均に差をもたらすと考えられることから注目する要因</li>
<li><strong>水準</strong>：1つの要因に含まれる項目のこと</li>
<li><strong>〇元配置</strong>：データに含まれる因子の数を表すもの</li>
</ul>
<h3 id="%E5%88%86%E6%95%A3%E5%88%86%E6%9E%90%E3%81%AE%E7%A8%AE%E9%A1%9E%E5%86%8D%E6%8E%B2">分散分析の種類（再掲）</h3>
<p>分散分析にはいくつかの種類があります。</p>
<ul>
<li>
<p>「一元配置分散分析」：1つの因子からデータを分析する方法。<br>
　　　　　　　　　　　因子に含まれる水準間の平均値の差を見ることができる。</p>
</li>
<li>
<p>「二元配置分散分析」：2つの因子からなるデータを分析する方法。<br>
　　　　　　　　　　　各因子における水準間の平均値の差を見ることができる。<br>
　　　　　　　　　　　また、2つの要因が組み合わさることで現れる相乗効果の有無も確認できる。</p>
</li>
<li>
<p>「多元配置分散分析」：3つ以上の因子からなるデータを分析する方法。</p>
</li>
</ul>
<div style="page-break-before:always"></div>
<h2 id="%E4%BA%8C%E5%85%83%E9%85%8D%E7%BD%AE%E5%88%86%E6%95%A3%E5%88%86%E6%9E%90">二元配置分散分析</h2>
<p>二元配置分散分析では、因子が2つになります。</p>
<p>二元配置分散分析でも同様に、<br>
「全体平均から因子の各水準の平均値がどの程度ズレているか」に注目します。</p>
<p>2つの因子が組み合わさることで初めて現れる相乗効果のことを<strong>交互作用</strong>といいます。<br>
反対に、1つの因子に絞った場合の効果を<strong>主作用</strong>といいます。<br>
（詳しくは<a href="https://bellcurve.jp/statistics/course/10090.html">こちら</a>を参照してください）</p>
<p>二元配置分散分析では、必ず考慮しなければなりません。</p>
<h3 id="%E5%88%86%E6%95%A3%E5%88%86%E6%9E%90%E8%A1%A8">分散分析表</h3>
<p>二元配置分散分析の分散分析表は以下の通りです。</p>
<table>
<thead>
<tr>
<th style="text-align:center">因子</th>
<th style="text-align:center">平方和</th>
<th style="text-align:center">自由度</th>
<th style="text-align:center">平均平方</th>
<th style="text-align:center">F値</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">要因1</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">要因2</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">交互作用</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">残差</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">全体</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<p>「平方和」の部分にはそれぞれのズレの二乗和が入ります。</p>
<ul>
<li>「要因1・2」：全体平均から各群の平均値のズレ</li>
<li>「交互作用」：全体平均から2群合わせた平均値のズレを求め、<br>
　　　　　　　そこから「要因1・2」を引いたもの</li>
<li>「残差」：「全体」から「要素1・2」と「交互作用」を引いたもの</li>
<li>「全体」：全体平均から各データのズレ</li>
</ul>
<p>「自由度」は以下のものが入ります。</p>
<ul>
<li>「要因1・2」：因子の水準の個数から1を引いたもの</li>
<li>「交互作用」：2つの因子の水準数から1を引いたものをかけあわせたもの</li>
<li>「残差」：「全体」から「要素1・2」と「交互作用」を引いたもの</li>
<li>「全体」：すべてのデータの個数から1を引いたもの</li>
</ul>
<p>「平均平方」には「平方和」を「自由度」で割ったものが入ります。</p>
<p>最後に「各因子の平均平方」を分子に、「残差の平均平方」を分母にして<br>
統計量$F$を算出します。</p>
<div style="page-break-before:always"></div>
<h3 id="%E6%BC%94%E7%BF%92">演習</h3>
<p>まずは<a href="https://bit.ly/41A6n19">こちら</a>の例題について、分散分析を行ってみます。</p>
<pre class="hljs"><code><div>df = pd.read_excel(<span class="hljs-string">"crop_yield.xlsx"</span>)
df.iloc[[<span class="hljs-number">0</span>,<span class="hljs-number">4</span>,<span class="hljs-number">7</span>,<span class="hljs-number">10</span>,<span class="hljs-number">13</span>,<span class="hljs-number">16</span>,<span class="hljs-number">19</span>,<span class="hljs-number">22</span>]]
</div></code></pre>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>土の種類</th>
      <th>肥料の量(g)</th>
      <th>収量(kg)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>土A</td>
      <td>100</td>
      <td>14.5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>土A</td>
      <td>200</td>
      <td>16.1</td>
    </tr>
    <tr>
      <th>7</th>
      <td>土A</td>
      <td>300</td>
      <td>19.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>土A</td>
      <td>400</td>
      <td>20.2</td>
    </tr>
    <tr>
      <th>13</th>
      <td>土B</td>
      <td>100</td>
      <td>15.3</td>
    </tr>
    <tr>
      <th>16</th>
      <td>土B</td>
      <td>200</td>
      <td>16.9</td>
    </tr>
    <tr>
      <th>19</th>
      <td>土B</td>
      <td>300</td>
      <td>20.5</td>
    </tr>
    <tr>
      <th>22</th>
      <td>土B</td>
      <td>400</td>
      <td>24.9</td>
    </tr>
  </tbody>
</table>
</div>
<p>ここで用語について整理します。</p>
<ul>
<li><strong>要因</strong>：「収量」に変化を与える要素のこと。<br>
　　　　今回の場合は、「土の種類」「肥料の量」のほかに「天気」など様々なものが考えられる。</li>
<li><strong>因子</strong>：要因の中でも特に、「映画館の数」の母平均に差をもたらすと考えられる<br>
　　　「土の種類」「肥料の量」のこと。</li>
<li><strong>水準</strong>：土の種類の水準数は「2」、肥料の量の水準数は「4」。</li>
<li><strong>二元配置</strong>：今回は因子が「土の種類」「肥料の量」であるので「二元配置」。</li>
</ul>
<div style="page-break-before:always"></div>
<h3 id="%E4%BB%AE%E8%AA%AC%E6%A4%9C%E5%AE%9A%E3%81%AE%E3%82%B9%E3%83%86%E3%83%83%E3%83%97%E5%86%8D%E6%8E%B2">仮説検定のステップ（再掲）</h3>
<p>①帰無仮説と対立仮説を立てる<br>
②帰無仮説のもとで標本観察を行う<br>
③帰無仮説を棄却できるかどうかを確認する</p>
<div style="page-break-before:always"></div>
<h4 id="%E5%B8%B0%E7%84%A1%E4%BB%AE%E8%AA%AC%E3%81%A8%E5%AF%BE%E7%AB%8B%E4%BB%AE%E8%AA%AC%E3%82%92%E7%AB%8B%E3%81%A6%E3%82%8B">帰無仮説と対立仮説を立てる</h4>
<p>帰無仮説と対立仮説は以下のようになります。（<strong>片側検定（上側）</strong> になります）</p>
<p>帰無仮説$H_0$：「各因子の水準間で作物の収量の平均値は等しい」<br>
対立仮説$H_1$：「各因子の水準間で作物の収量の平均値では差がある」</p>
<p>分散分析では「残差のばらつき」に対して「要因のばらつき」が大きいかどうかを検定するため、<br>
必ず「片側検定」を行います。</p>
<div style="page-break-before:always"></div>
<h4 id="%E5%B8%B0%E7%84%A1%E4%BB%AE%E8%AA%AC%E3%81%AE%E3%82%82%E3%81%A8%E3%81%A7%E6%A8%99%E6%9C%AC%E8%A6%B3%E5%AF%9F%E3%82%92%E8%A1%8C%E3%81%86">帰無仮説のもとで標本観察を行う</h4>
<h5 id="%E5%85%A8%E4%BD%93%E5%B9%B3%E5%9D%87%E3%81%A8%E5%90%84%E7%BE%A4%E3%81%AE%E5%B9%B3%E5%9D%87%E5%80%A4%E3%81%AE%E5%B0%8E%E5%87%BA">全体平均と各群の平均値の導出</h5>
<p>以下のようになります。</p>
<pre class="hljs"><code><div>df[<span class="hljs-string">"収量(kg)"</span>].mean()
</div></code></pre>
<pre><code>18.229166666666668
</code></pre>
<pre class="hljs"><code><div>new_df1 = df.groupby([<span class="hljs-string">"土の種類"</span>]).mean()
new_df1 = new_df1.reset_index()
new_df1
</div></code></pre>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>土の種類</th>
      <th>肥料の量(g)</th>
      <th>収量(kg)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>土A</td>
      <td>250.0</td>
      <td>16.566667</td>
    </tr>
    <tr>
      <th>1</th>
      <td>土B</td>
      <td>250.0</td>
      <td>19.891667</td>
    </tr>
  </tbody>
</table>
</div>
<pre class="hljs"><code><div>new_df2 = df.groupby([<span class="hljs-string">"肥料の量(g)"</span>]).mean()
new_df2 = new_df2.reset_index()
new_df2
</div></code></pre>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>肥料の量(g)</th>
      <th>収量(kg)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>100</td>
      <td>15.450000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>200</td>
      <td>16.950000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>300</td>
      <td>18.933333</td>
    </tr>
    <tr>
      <th>3</th>
      <td>400</td>
      <td>21.583333</td>
    </tr>
  </tbody>
</table>
</div>
<pre class="hljs"><code><div>new_df3 = df.groupby([<span class="hljs-string">"土の種類"</span>,<span class="hljs-string">"肥料の量(g)"</span>]).mean()
new_df3 = new_df3.reset_index()
new_df3
</div></code></pre>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>土の種類</th>
      <th>肥料の量(g)</th>
      <th>収量(kg)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>土A</td>
      <td>100</td>
      <td>14.566667</td>
    </tr>
    <tr>
      <th>1</th>
      <td>土A</td>
      <td>200</td>
      <td>15.866667</td>
    </tr>
    <tr>
      <th>2</th>
      <td>土A</td>
      <td>300</td>
      <td>17.333333</td>
    </tr>
    <tr>
      <th>3</th>
      <td>土A</td>
      <td>400</td>
      <td>18.500000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>土B</td>
      <td>100</td>
      <td>16.333333</td>
    </tr>
    <tr>
      <th>5</th>
      <td>土B</td>
      <td>200</td>
      <td>18.033333</td>
    </tr>
    <tr>
      <th>6</th>
      <td>土B</td>
      <td>300</td>
      <td>20.533333</td>
    </tr>
    <tr>
      <th>7</th>
      <td>土B</td>
      <td>400</td>
      <td>24.666667</td>
    </tr>
  </tbody>
</table>
</div>
 <div style="page-break-before:always"></div>
<h5 id="%E5%85%A8%E4%BD%93%E5%B9%B3%E5%9D%87%E3%81%8B%E3%82%89%E5%90%84%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E3%82%BA%E3%83%AC">全体平均から各データのズレ</h5>
<p>このズレの二乗和を求めます。</p>
<pre class="hljs"><code><div>df[<span class="hljs-string">"全体平均 - 各データ"</span>] = (df[<span class="hljs-string">"収量(kg)"</span>] - df[<span class="hljs-string">"収量(kg)"</span>].mean())**<span class="hljs-number">2</span>
df.iloc[[<span class="hljs-number">0</span>,<span class="hljs-number">4</span>,<span class="hljs-number">7</span>,<span class="hljs-number">10</span>,<span class="hljs-number">13</span>,<span class="hljs-number">16</span>,<span class="hljs-number">19</span>,<span class="hljs-number">22</span>]]
</div></code></pre>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>土の種類</th>
      <th>肥料の量(g)</th>
      <th>収量(kg)</th>
      <th>全体平均 - 各データ</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>土A</td>
      <td>100</td>
      <td>14.5</td>
      <td>13.906684</td>
    </tr>
    <tr>
      <th>4</th>
      <td>土A</td>
      <td>200</td>
      <td>16.1</td>
      <td>4.533351</td>
    </tr>
    <tr>
      <th>7</th>
      <td>土A</td>
      <td>300</td>
      <td>19.0</td>
      <td>0.594184</td>
    </tr>
    <tr>
      <th>10</th>
      <td>土A</td>
      <td>400</td>
      <td>20.2</td>
      <td>3.884184</td>
    </tr>
    <tr>
      <th>13</th>
      <td>土B</td>
      <td>100</td>
      <td>15.3</td>
      <td>8.580017</td>
    </tr>
    <tr>
      <th>16</th>
      <td>土B</td>
      <td>200</td>
      <td>16.9</td>
      <td>1.766684</td>
    </tr>
    <tr>
      <th>19</th>
      <td>土B</td>
      <td>300</td>
      <td>20.5</td>
      <td>5.156684</td>
    </tr>
    <tr>
      <th>22</th>
      <td>土B</td>
      <td>400</td>
      <td>24.9</td>
      <td>44.500017</td>
    </tr>
  </tbody>
</table>
</div>
<pre class="hljs"><code><div>zentai = round(sum(df[<span class="hljs-string">"全体平均 - 各データ"</span>]),<span class="hljs-number">2</span>)
round(sum(df[<span class="hljs-string">"全体平均 - 各データ"</span>]),<span class="hljs-number">2</span>)
</div></code></pre>
<pre><code>233.67
</code></pre>
<div style="page-break-before:always"></div>
<h5 id="%E5%85%A8%E4%BD%93%E5%B9%B3%E5%9D%87%E3%81%8B%E3%82%89%E5%90%84%E7%BE%A4%E3%81%AE%E5%B9%B3%E5%9D%87%E5%80%A4%E3%81%AE%E3%82%BA%E3%83%AC">全体平均から各群の平均値のズレ</h5>
<p>このズレの二乗和を求めます。</p>
<p>まずは「土の種類の平方和」です。</p>
<pre class="hljs"><code><div>df = pd.read_excel(<span class="hljs-string">"crop_yield.xlsx"</span>)
df.iloc[[<span class="hljs-number">0</span>,<span class="hljs-number">4</span>,<span class="hljs-number">7</span>,<span class="hljs-number">10</span>,<span class="hljs-number">13</span>,<span class="hljs-number">16</span>,<span class="hljs-number">19</span>,<span class="hljs-number">22</span>]]
</div></code></pre>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>土の種類</th>
      <th>肥料の量(g)</th>
      <th>収量(kg)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>土A</td>
      <td>100</td>
      <td>14.5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>土A</td>
      <td>200</td>
      <td>16.1</td>
    </tr>
    <tr>
      <th>7</th>
      <td>土A</td>
      <td>300</td>
      <td>19.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>土A</td>
      <td>400</td>
      <td>20.2</td>
    </tr>
    <tr>
      <th>13</th>
      <td>土B</td>
      <td>100</td>
      <td>15.3</td>
    </tr>
    <tr>
      <th>16</th>
      <td>土B</td>
      <td>200</td>
      <td>16.9</td>
    </tr>
    <tr>
      <th>19</th>
      <td>土B</td>
      <td>300</td>
      <td>20.5</td>
    </tr>
    <tr>
      <th>22</th>
      <td>土B</td>
      <td>400</td>
      <td>24.9</td>
    </tr>
  </tbody>
</table>
</div>
<div style="page-break-before:always"></div>
<pre class="hljs"><code><div>goukei = []
new_tuthi = new_df1[<span class="hljs-string">"土の種類"</span>]
new_tuthi_uni = new_df1[<span class="hljs-string">"土の種類"</span>].unique()

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(df[<span class="hljs-string">"収量(kg)"</span>])):
  <span class="hljs-keyword">if</span> df.loc[i][<span class="hljs-string">"土の種類"</span>] <span class="hljs-keyword">in</span> new_tuthi_uni:
    goukei.append(float(new_df1[new_tuthi == df.loc[i][<span class="hljs-string">"土の種類"</span>]][<span class="hljs-string">"収量(kg)"</span>]))

df[<span class="hljs-string">"群の平均値"</span>] = pd.Series(goukei)
df.iloc[[<span class="hljs-number">0</span>,<span class="hljs-number">4</span>,<span class="hljs-number">7</span>,<span class="hljs-number">10</span>,<span class="hljs-number">13</span>,<span class="hljs-number">16</span>,<span class="hljs-number">19</span>,<span class="hljs-number">22</span>]]
</div></code></pre>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>土の種類</th>
      <th>肥料の量(g)</th>
      <th>収量(kg)</th>
      <th>群の平均値</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>土A</td>
      <td>100</td>
      <td>14.5</td>
      <td>16.566667</td>
    </tr>
    <tr>
      <th>4</th>
      <td>土A</td>
      <td>200</td>
      <td>16.1</td>
      <td>16.566667</td>
    </tr>
    <tr>
      <th>7</th>
      <td>土A</td>
      <td>300</td>
      <td>19.0</td>
      <td>16.566667</td>
    </tr>
    <tr>
      <th>10</th>
      <td>土A</td>
      <td>400</td>
      <td>20.2</td>
      <td>16.566667</td>
    </tr>
    <tr>
      <th>13</th>
      <td>土B</td>
      <td>100</td>
      <td>15.3</td>
      <td>19.891667</td>
    </tr>
    <tr>
      <th>16</th>
      <td>土B</td>
      <td>200</td>
      <td>16.9</td>
      <td>19.891667</td>
    </tr>
    <tr>
      <th>19</th>
      <td>土B</td>
      <td>300</td>
      <td>20.5</td>
      <td>19.891667</td>
    </tr>
    <tr>
      <th>22</th>
      <td>土B</td>
      <td>400</td>
      <td>24.9</td>
      <td>19.891667</td>
    </tr>
  </tbody>
</table>
</div>
 <div style="page-break-before:always"></div>
<pre class="hljs"><code><div>df[<span class="hljs-string">"全体平均 - 因子の平均"</span>] = (df[<span class="hljs-string">"収量(kg)"</span>].mean() - df[<span class="hljs-string">"群の平均値"</span>])**<span class="hljs-number">2</span>
df.iloc[[<span class="hljs-number">0</span>,<span class="hljs-number">4</span>,<span class="hljs-number">7</span>,<span class="hljs-number">10</span>,<span class="hljs-number">13</span>,<span class="hljs-number">16</span>,<span class="hljs-number">19</span>,<span class="hljs-number">22</span>]]
</div></code></pre>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>土の種類</th>
      <th>肥料の量(g)</th>
      <th>収量(kg)</th>
      <th>群の平均値</th>
      <th>全体平均 - 因子の平均</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>土A</td>
      <td>100</td>
      <td>14.5</td>
      <td>16.566667</td>
      <td>2.763906</td>
    </tr>
    <tr>
      <th>4</th>
      <td>土A</td>
      <td>200</td>
      <td>16.1</td>
      <td>16.566667</td>
      <td>2.763906</td>
    </tr>
    <tr>
      <th>7</th>
      <td>土A</td>
      <td>300</td>
      <td>19.0</td>
      <td>16.566667</td>
      <td>2.763906</td>
    </tr>
    <tr>
      <th>10</th>
      <td>土A</td>
      <td>400</td>
      <td>20.2</td>
      <td>16.566667</td>
      <td>2.763906</td>
    </tr>
    <tr>
      <th>13</th>
      <td>土B</td>
      <td>100</td>
      <td>15.3</td>
      <td>19.891667</td>
      <td>2.763906</td>
    </tr>
    <tr>
      <th>16</th>
      <td>土B</td>
      <td>200</td>
      <td>16.9</td>
      <td>19.891667</td>
      <td>2.763906</td>
    </tr>
    <tr>
      <th>19</th>
      <td>土B</td>
      <td>300</td>
      <td>20.5</td>
      <td>19.891667</td>
      <td>2.763906</td>
    </tr>
    <tr>
      <th>22</th>
      <td>土B</td>
      <td>400</td>
      <td>24.9</td>
      <td>19.891667</td>
      <td>2.763906</td>
    </tr>
  </tbody>
</table>
</div>
<pre class="hljs"><code><div>tuthi = round(sum(df[<span class="hljs-string">"全体平均 - 因子の平均"</span>]),<span class="hljs-number">2</span>)
round(sum(df[<span class="hljs-string">"全体平均 - 因子の平均"</span>]),<span class="hljs-number">2</span>)
</div></code></pre>
<pre><code>66.33
</code></pre>
<div style="page-break-before:always"></div>
<p>次に「肥料の量の平方和」です。</p>
<pre class="hljs"><code><div>df = pd.read_excel(<span class="hljs-string">"crop_yield.xlsx"</span>)
df.iloc[[<span class="hljs-number">0</span>,<span class="hljs-number">4</span>,<span class="hljs-number">7</span>,<span class="hljs-number">10</span>,<span class="hljs-number">13</span>,<span class="hljs-number">16</span>,<span class="hljs-number">19</span>,<span class="hljs-number">22</span>]]
</div></code></pre>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>土の種類</th>
      <th>肥料の量(g)</th>
      <th>収量(kg)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>土A</td>
      <td>100</td>
      <td>14.5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>土A</td>
      <td>200</td>
      <td>16.1</td>
    </tr>
    <tr>
      <th>7</th>
      <td>土A</td>
      <td>300</td>
      <td>19.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>土A</td>
      <td>400</td>
      <td>20.2</td>
    </tr>
    <tr>
      <th>13</th>
      <td>土B</td>
      <td>100</td>
      <td>15.3</td>
    </tr>
    <tr>
      <th>16</th>
      <td>土B</td>
      <td>200</td>
      <td>16.9</td>
    </tr>
    <tr>
      <th>19</th>
      <td>土B</td>
      <td>300</td>
      <td>20.5</td>
    </tr>
    <tr>
      <th>22</th>
      <td>土B</td>
      <td>400</td>
      <td>24.9</td>
    </tr>
  </tbody>
</table>
</div>
<pre class="hljs"><code><div>goukei = []
new_hiryo = new_df2[<span class="hljs-string">"肥料の量(g)"</span>]
new_hiryo_uni = new_df2[<span class="hljs-string">"肥料の量(g)"</span>].unique()

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(df[<span class="hljs-string">"収量(kg)"</span>])):
  <span class="hljs-keyword">if</span> df.loc[i][<span class="hljs-string">"肥料の量(g)"</span>] <span class="hljs-keyword">in</span> new_hiryo_uni:
    goukei.append(float(new_df2[new_hiryo == df.loc[i][<span class="hljs-string">"肥料の量(g)"</span>]][<span class="hljs-string">"収量(kg)"</span>]))

df[<span class="hljs-string">"群の平均値"</span>] = pd.Series(goukei)
df.iloc[[<span class="hljs-number">0</span>,<span class="hljs-number">4</span>,<span class="hljs-number">7</span>,<span class="hljs-number">10</span>,<span class="hljs-number">13</span>,<span class="hljs-number">16</span>,<span class="hljs-number">19</span>,<span class="hljs-number">22</span>]]
</div></code></pre>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>土の種類</th>
      <th>肥料の量(g)</th>
      <th>収量(kg)</th>
      <th>群の平均値</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>土A</td>
      <td>100</td>
      <td>14.5</td>
      <td>15.450000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>土A</td>
      <td>200</td>
      <td>16.1</td>
      <td>16.950000</td>
    </tr>
    <tr>
      <th>7</th>
      <td>土A</td>
      <td>300</td>
      <td>19.0</td>
      <td>18.933333</td>
    </tr>
    <tr>
      <th>10</th>
      <td>土A</td>
      <td>400</td>
      <td>20.2</td>
      <td>21.583333</td>
    </tr>
    <tr>
      <th>13</th>
      <td>土B</td>
      <td>100</td>
      <td>15.3</td>
      <td>15.450000</td>
    </tr>
    <tr>
      <th>16</th>
      <td>土B</td>
      <td>200</td>
      <td>16.9</td>
      <td>16.950000</td>
    </tr>
    <tr>
      <th>19</th>
      <td>土B</td>
      <td>300</td>
      <td>20.5</td>
      <td>18.933333</td>
    </tr>
    <tr>
      <th>22</th>
      <td>土B</td>
      <td>400</td>
      <td>24.9</td>
      <td>21.583333</td>
    </tr>
  </tbody>
</table>
</div>
<div style="page-break-before:always"></div>
<pre class="hljs"><code><div>df[<span class="hljs-string">"全体平均 - 因子の平均"</span>] = (df[<span class="hljs-string">"収量(kg)"</span>].mean() - df[<span class="hljs-string">"群の平均値"</span>])**<span class="hljs-number">2</span>
df.iloc[[<span class="hljs-number">0</span>,<span class="hljs-number">4</span>,<span class="hljs-number">7</span>,<span class="hljs-number">10</span>,<span class="hljs-number">13</span>,<span class="hljs-number">16</span>,<span class="hljs-number">19</span>,<span class="hljs-number">22</span>]]
</div></code></pre>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>土の種類</th>
      <th>肥料の量(g)</th>
      <th>収量(kg)</th>
      <th>群の平均値</th>
      <th>全体平均 - 因子の平均</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>土A</td>
      <td>100</td>
      <td>14.5</td>
      <td>15.450000</td>
      <td>7.723767</td>
    </tr>
    <tr>
      <th>4</th>
      <td>土A</td>
      <td>200</td>
      <td>16.1</td>
      <td>16.950000</td>
      <td>1.636267</td>
    </tr>
    <tr>
      <th>7</th>
      <td>土A</td>
      <td>300</td>
      <td>19.0</td>
      <td>18.933333</td>
      <td>0.495851</td>
    </tr>
    <tr>
      <th>10</th>
      <td>土A</td>
      <td>400</td>
      <td>20.2</td>
      <td>21.583333</td>
      <td>11.250434</td>
    </tr>
    <tr>
      <th>13</th>
      <td>土B</td>
      <td>100</td>
      <td>15.3</td>
      <td>15.450000</td>
      <td>7.723767</td>
    </tr>
    <tr>
      <th>16</th>
      <td>土B</td>
      <td>200</td>
      <td>16.9</td>
      <td>16.950000</td>
      <td>1.636267</td>
    </tr>
    <tr>
      <th>19</th>
      <td>土B</td>
      <td>300</td>
      <td>20.5</td>
      <td>18.933333</td>
      <td>0.495851</td>
    </tr>
    <tr>
      <th>22</th>
      <td>土B</td>
      <td>400</td>
      <td>24.9</td>
      <td>21.583333</td>
      <td>11.250434</td>
    </tr>
  </tbody>
</table>
</div>
<pre class="hljs"><code><div>hiryo = round(sum(df[<span class="hljs-string">"全体平均 - 因子の平均"</span>]),<span class="hljs-number">2</span>)
round(sum(df[<span class="hljs-string">"全体平均 - 因子の平均"</span>]),<span class="hljs-number">2</span>)
</div></code></pre>
<pre><code>126.64
</code></pre>
<div style="page-break-before:always"></div>
<h5 id="%E4%BA%A4%E4%BA%92%E4%BD%9C%E7%94%A8%E3%81%AE%E5%B9%B3%E6%96%B9%E5%92%8C">交互作用の平方和</h5>
<p>「土の種類×肥料の量 の平方和」を求めます。</p>
<pre class="hljs"><code><div>df = pd.read_excel(<span class="hljs-string">"crop_yield.xlsx"</span>)
df.iloc[[<span class="hljs-number">0</span>,<span class="hljs-number">4</span>,<span class="hljs-number">7</span>,<span class="hljs-number">10</span>,<span class="hljs-number">13</span>,<span class="hljs-number">16</span>,<span class="hljs-number">19</span>,<span class="hljs-number">22</span>]]
</div></code></pre>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>土の種類</th>
      <th>肥料の量(g)</th>
      <th>収量(kg)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>土A</td>
      <td>100</td>
      <td>14.5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>土A</td>
      <td>200</td>
      <td>16.1</td>
    </tr>
    <tr>
      <th>7</th>
      <td>土A</td>
      <td>300</td>
      <td>19.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>土A</td>
      <td>400</td>
      <td>20.2</td>
    </tr>
    <tr>
      <th>13</th>
      <td>土B</td>
      <td>100</td>
      <td>15.3</td>
    </tr>
    <tr>
      <th>16</th>
      <td>土B</td>
      <td>200</td>
      <td>16.9</td>
    </tr>
    <tr>
      <th>19</th>
      <td>土B</td>
      <td>300</td>
      <td>20.5</td>
    </tr>
    <tr>
      <th>22</th>
      <td>土B</td>
      <td>400</td>
      <td>24.9</td>
    </tr>
  </tbody>
</table>
</div>
<div style="page-break-before:always"></div>
<pre class="hljs"><code><div>goukei = []
new_tuthi = new_df3[<span class="hljs-string">"土の種類"</span>]
new_hiryo = new_df3[<span class="hljs-string">"肥料の量(g)"</span>]
new_tuthi_uni = new_df3[<span class="hljs-string">"土の種類"</span>].unique()
new_hiryo_uni = new_df3[<span class="hljs-string">"肥料の量(g)"</span>].unique()

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(df[<span class="hljs-string">"収量(kg)"</span>])):
  <span class="hljs-keyword">if</span> df.loc[i][<span class="hljs-string">"土の種類"</span>] <span class="hljs-keyword">in</span> new_tuthi_uni <span class="hljs-keyword">and</span> df.loc[i][<span class="hljs-string">"肥料の量(g)"</span>] <span class="hljs-keyword">in</span> new_hiryo_uni:
    goukei.append(float(new_df3[(new_tuthi == df.loc[i][<span class="hljs-string">"土の種類"</span>]) &amp;  
     (new_hiryo == df.loc[i][<span class="hljs-string">"肥料の量(g)"</span>])][<span class="hljs-string">"収量(kg)"</span>]))

df[<span class="hljs-string">"群の平均値"</span>] = pd.Series(goukei)
df.iloc[[<span class="hljs-number">0</span>,<span class="hljs-number">4</span>,<span class="hljs-number">7</span>,<span class="hljs-number">10</span>,<span class="hljs-number">13</span>,<span class="hljs-number">16</span>,<span class="hljs-number">19</span>,<span class="hljs-number">22</span>]]
</div></code></pre>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>土の種類</th>
      <th>肥料の量(g)</th>
      <th>収量(kg)</th>
      <th>群の平均値</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>土A</td>
      <td>100</td>
      <td>14.5</td>
      <td>14.566667</td>
    </tr>
    <tr>
      <th>4</th>
      <td>土A</td>
      <td>200</td>
      <td>16.1</td>
      <td>15.866667</td>
    </tr>
    <tr>
      <th>7</th>
      <td>土A</td>
      <td>300</td>
      <td>19.0</td>
      <td>17.333333</td>
    </tr>
    <tr>
      <th>10</th>
      <td>土A</td>
      <td>400</td>
      <td>20.2</td>
      <td>18.500000</td>
    </tr>
    <tr>
      <th>13</th>
      <td>土B</td>
      <td>100</td>
      <td>15.3</td>
      <td>16.333333</td>
    </tr>
    <tr>
      <th>16</th>
      <td>土B</td>
      <td>200</td>
      <td>16.9</td>
      <td>18.033333</td>
    </tr>
    <tr>
      <th>19</th>
      <td>土B</td>
      <td>300</td>
      <td>20.5</td>
      <td>20.533333</td>
    </tr>
    <tr>
      <th>22</th>
      <td>土B</td>
      <td>400</td>
      <td>24.9</td>
      <td>24.666667</td>
    </tr>
  </tbody>
</table>
</div>
<div style="page-break-before:always"></div>
<pre class="hljs"><code><div>df[<span class="hljs-string">"全体平均 - 因子の平均"</span>] = (df[<span class="hljs-string">"収量(kg)"</span>].mean() - df[<span class="hljs-string">"群の平均値"</span>])**<span class="hljs-number">2</span>
df.iloc[[<span class="hljs-number">0</span>,<span class="hljs-number">4</span>,<span class="hljs-number">7</span>,<span class="hljs-number">10</span>,<span class="hljs-number">13</span>,<span class="hljs-number">16</span>,<span class="hljs-number">19</span>,<span class="hljs-number">22</span>]]
</div></code></pre>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>土の種類</th>
      <th>肥料の量(g)</th>
      <th>収量(kg)</th>
      <th>群の平均値</th>
      <th>全体平均 - 因子の平均</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>土A</td>
      <td>100</td>
      <td>14.5</td>
      <td>14.566667</td>
      <td>13.413906</td>
    </tr>
    <tr>
      <th>4</th>
      <td>土A</td>
      <td>200</td>
      <td>16.1</td>
      <td>15.866667</td>
      <td>5.581406</td>
    </tr>
    <tr>
      <th>7</th>
      <td>土A</td>
      <td>300</td>
      <td>19.0</td>
      <td>17.333333</td>
      <td>0.802517</td>
    </tr>
    <tr>
      <th>10</th>
      <td>土A</td>
      <td>400</td>
      <td>20.2</td>
      <td>18.500000</td>
      <td>0.073351</td>
    </tr>
    <tr>
      <th>13</th>
      <td>土B</td>
      <td>100</td>
      <td>15.3</td>
      <td>16.333333</td>
      <td>3.594184</td>
    </tr>
    <tr>
      <th>16</th>
      <td>土B</td>
      <td>200</td>
      <td>16.9</td>
      <td>18.033333</td>
      <td>0.038351</td>
    </tr>
    <tr>
      <th>19</th>
      <td>土B</td>
      <td>300</td>
      <td>20.5</td>
      <td>20.533333</td>
      <td>5.309184</td>
    </tr>
    <tr>
      <th>22</th>
      <td>土B</td>
      <td>400</td>
      <td>24.9</td>
      <td>24.666667</td>
      <td>41.441406</td>
    </tr>
  </tbody>
</table>
</div>
<pre class="hljs"><code><div>round(sum(df[<span class="hljs-string">"全体平均 - 因子の平均"</span>]),<span class="hljs-number">2</span>)
</div></code></pre>
<pre><code>210.76
</code></pre>
<pre class="hljs"><code><div>hiryo_tuthi = round(sum(df[<span class="hljs-string">"全体平均 - 因子の平均"</span>]),<span class="hljs-number">2</span>)
kougosayou =  round(hiryo_tuthi - tuthi - hiryo, <span class="hljs-number">2</span>)
kougosayou
</div></code></pre>
<pre><code>17.79
</code></pre>
<h5 id="%E6%AE%8B%E5%B7%AE%E3%81%AE%E5%B9%B3%E6%96%B9%E5%92%8C">残差の平方和</h5>
<pre class="hljs"><code><div>zansa = round(zentai - tuthi - hiryo - kougosayou, <span class="hljs-number">2</span>)
print(zansa)
</div></code></pre>
<pre><code>22.91
</code></pre>
<div style="page-break-before:always"></div>
<h5 id="%E8%87%AA%E7%94%B1%E5%BA%A6%E3%81%8B%E3%82%89%E5%B9%B3%E5%9D%87%E5%B9%B3%E6%96%B9">自由度から平均平方</h5>
<p>ここまで分かったことを、分散分析表にまとめていきます。</p>
<table>
<thead>
<tr>
<th style="text-align:center">因子</th>
<th style="text-align:center">平方和</th>
<th style="text-align:center">自由度</th>
<th style="text-align:center">平均平方</th>
<th style="text-align:center">F値</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">肥料の量</td>
<td style="text-align:center">126.64</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">土の種類</td>
<td style="text-align:center">66.33</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">肥料の量×土の種類</td>
<td style="text-align:center">17.79</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">残差</td>
<td style="text-align:center">22.91</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">全体</td>
<td style="text-align:center">233.67</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<p>自由度は以下のようにして求めます。</p>
<ul>
<li>「肥料の量」：4パターンあるので自由度は 4 ー1＝3</li>
<li>「土の種類」：2パターンあるので自由度は 2 ー1＝1</li>
<li>「肥料の量×土の種類」：自由度は 3 × 1＝3</li>
<li>「残差」：自由度は 23 ー(3＋1＋3)＝16</li>
<li>「全体」：データ数は24なので自由度は 24 ー1＝23</li>
</ul>
<p>自由度が求まったので、平均平方も求められます。</p>
<table>
<thead>
<tr>
<th style="text-align:center">因子</th>
<th style="text-align:center">平方和</th>
<th style="text-align:center">自由度</th>
<th style="text-align:center">平均平方</th>
<th style="text-align:center">F値</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">肥料の量</td>
<td style="text-align:center">126.64</td>
<td style="text-align:center">3</td>
<td style="text-align:center">42.21</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">土の種類</td>
<td style="text-align:center">66.33</td>
<td style="text-align:center">1</td>
<td style="text-align:center">66.33</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">肥料の量×土の種類</td>
<td style="text-align:center">17.79</td>
<td style="text-align:center">3</td>
<td style="text-align:center">5.93</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">残差</td>
<td style="text-align:center">22.91</td>
<td style="text-align:center">16</td>
<td style="text-align:center">1.43</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">全体</td>
<td style="text-align:center">233.67</td>
<td style="text-align:center">23</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<div style="page-break-before:always"></div>
<h5 id="%E7%B5%B1%E8%A8%88%E9%87%8Ff">統計量$F$</h5>
<p>要因の平均平方を「分子」、残差の平均平方を「分母」として、<br>
統計量$F$を算出します。</p>
<p>$$
F_{肥料} = \frac{s^2_{肥料}}{s^2_{残差}} = \frac{42.21}{1.43} = 29.49
$$</p>
<p>$$
F_{土} = \frac{s^2_{土}}{s^2_{残差}} = \frac{66.33}{1.43} = 46.33
$$</p>
<p>$$
F_{肥料×土} = \frac{s^2_{肥料×土}}{s^2_{残差}} = \frac{5.93}{1.43} = 4.14
$$</p>
<table>
<thead>
<tr>
<th style="text-align:center">因子</th>
<th style="text-align:center">平方和</th>
<th style="text-align:center">自由度</th>
<th style="text-align:center">平均平方</th>
<th style="text-align:center">F値</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">肥料の量</td>
<td style="text-align:center">126.64</td>
<td style="text-align:center">3</td>
<td style="text-align:center">42.21</td>
<td style="text-align:center">29.49</td>
</tr>
<tr>
<td style="text-align:center">土の種類</td>
<td style="text-align:center">66.33</td>
<td style="text-align:center">1</td>
<td style="text-align:center">66.33</td>
<td style="text-align:center">46.33</td>
</tr>
<tr>
<td style="text-align:center">肥料の量×土の種類</td>
<td style="text-align:center">17.79</td>
<td style="text-align:center">3</td>
<td style="text-align:center">5.93</td>
<td style="text-align:center">4.14</td>
</tr>
<tr>
<td style="text-align:center">残差</td>
<td style="text-align:center">22.91</td>
<td style="text-align:center">16</td>
<td style="text-align:center">1.43</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">全体</td>
<td style="text-align:center">233.67</td>
<td style="text-align:center">23</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<div style="page-break-before:always"></div>
<h4 id="%E5%B8%B0%E7%84%A1%E4%BB%AE%E8%AA%AC%E3%82%92%E6%A3%84%E5%8D%B4%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%8B%E3%81%A9%E3%81%86%E3%81%8B%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B">帰無仮説を棄却できるかどうかを確認する</h4>
<p>有意水準を$5$%に設定します。</p>
<p>($p$<strong>値を求めて</strong>) 棄却が必要かどうか決めます。</p>
<h5 id="%E8%82%A5%E6%96%99%E3%81%AE%E9%87%8F%E3%81%AEf%E6%A4%9C%E5%AE%9A">肥料の量の$F$検定</h5>
<pre class="hljs"><code><div>fk = stats.f(dfn=<span class="hljs-number">3</span> , dfd=<span class="hljs-number">16</span>).ppf(<span class="hljs-number">0.95</span>)
fk
</div></code></pre>
<pre><code>3.238871517453585
</code></pre>
<pre class="hljs"><code><div>nyp = float(Decimal(str(stats.f(dfn=<span class="hljs-number">3</span> , dfd=<span class="hljs-number">16</span>).sf(fk)*<span class="hljs-number">100</span>)).
            quantize(Decimal(<span class="hljs-string">'0.001'</span>),rounding=ROUND_HALF_UP))
print(<span class="hljs-string">f"有意水準：<span class="hljs-subst">{nyp}</span>%"</span>)    <span class="hljs-comment"># 右側の棄却域の面積</span>

nkp = float(Decimal(str(stats.f(dfn=<span class="hljs-number">3</span> , dfd=<span class="hljs-number">16</span>).sf(<span class="hljs-number">29.49</span>)*<span class="hljs-number">100</span>)).
            quantize(Decimal(<span class="hljs-string">'0.000001'</span>),rounding=ROUND_HALF_UP))
print(<span class="hljs-string">f"p値：<span class="hljs-subst">{nkp}</span>%"</span>)
</div></code></pre>
<pre><code>有意水準：5.0%
p値：9.4e-05%
</code></pre>
<pre class="hljs"><code><div>print(<span class="hljs-string">"p値が有意水準より小さくなったので、帰無仮説を棄却し、対立仮説を採択する"</span>)
print(<span class="hljs-string">"したがって、肥料の量によって収量の平均値に差があるといえる"</span>)
</div></code></pre>
<pre><code>p値が有意水準より小さくなったので、帰無仮説を棄却し、対立仮説を採択する
したがって、肥料の量によって収量の平均値に差があるといえる
</code></pre>
<div style="page-break-before:always"></div>
<h5 id="%E5%9C%9F%E3%81%AE%E7%A8%AE%E9%A1%9E%E3%81%AEf%E6%A4%9C%E5%AE%9A">土の種類の$F$検定</h5>
<pre class="hljs"><code><div>fk = stats.f(dfn=<span class="hljs-number">1</span> , dfd=<span class="hljs-number">16</span>).ppf(<span class="hljs-number">0.95</span>)
fk
</div></code></pre>
<pre><code>4.493998477666352
</code></pre>
<pre class="hljs"><code><div>nyp = float(Decimal(str(stats.f(dfn=<span class="hljs-number">3</span> , dfd=<span class="hljs-number">16</span>).sf(fk)*<span class="hljs-number">100</span>)).
            quantize(Decimal(<span class="hljs-string">'0.001'</span>),rounding=ROUND_HALF_UP))
print(<span class="hljs-string">f"有意水準：<span class="hljs-subst">{nyp}</span>%"</span>)    <span class="hljs-comment"># 右側の棄却域の面積</span>

nkp = float(Decimal(str(stats.f(dfn=<span class="hljs-number">3</span> , dfd=<span class="hljs-number">16</span>).sf(<span class="hljs-number">46.33</span>)*<span class="hljs-number">100</span>)).
            quantize(Decimal(<span class="hljs-string">'0.000001'</span>),rounding=ROUND_HALF_UP))
print(<span class="hljs-string">f"p値：<span class="hljs-subst">{nkp}</span>%"</span>)
</div></code></pre>
<pre><code>有意水準：1.805%
p値：4e-06%
</code></pre>
<pre class="hljs"><code><div>print(<span class="hljs-string">"p値が有意水準より小さくなったので、帰無仮説を棄却し、対立仮説を採択する"</span>)
print(<span class="hljs-string">"したがって、土の種類によって収量の平均値に差があるといえる"</span>)
</div></code></pre>
<pre><code>p値が有意水準より小さくなったので、帰無仮説を棄却し、対立仮説を採択する
したがって、土の種類によって収量の平均値に差があるといえる
</code></pre>
<div style="page-break-before:always"></div>
<h5 id="%E4%BA%A4%E4%BA%92%E4%BD%9C%E7%94%A8%E3%81%AEf%E6%A4%9C%E5%AE%9A">交互作用の$F$検定</h5>
<p>※ 解説をだいぶ省略するので、解説が気になる方は<a href="https://bellcurve.jp/statistics/course/10090.html">こちら</a>を参照してください。</p>
<pre class="hljs"><code><div>fk = stats.f(dfn=<span class="hljs-number">3</span> , dfd=<span class="hljs-number">16</span>).ppf(<span class="hljs-number">0.95</span>)
fk
</div></code></pre>
<pre><code>3.238871517453585
</code></pre>
<pre class="hljs"><code><div>nyp = float(Decimal(str(stats.f(dfn=<span class="hljs-number">3</span> , dfd=<span class="hljs-number">16</span>).sf(fk)*<span class="hljs-number">100</span>)).
            quantize(Decimal(<span class="hljs-string">'0.001'</span>),rounding=ROUND_HALF_UP))
print(<span class="hljs-string">f"有意水準：<span class="hljs-subst">{nyp}</span>%"</span>)    <span class="hljs-comment"># 右側の棄却域の面積</span>

nkp = float(Decimal(str(stats.f(dfn=<span class="hljs-number">3</span> , dfd=<span class="hljs-number">16</span>).sf(<span class="hljs-number">4.14</span>)*<span class="hljs-number">100</span>)).
            quantize(Decimal(<span class="hljs-string">'0.000001'</span>),rounding=ROUND_HALF_UP))
print(<span class="hljs-string">f"p値：<span class="hljs-subst">{nkp}</span>%"</span>)
</div></code></pre>
<pre><code>有意水準：5.0%
p値：2.377795%
</code></pre>
<pre class="hljs"><code><div>print(<span class="hljs-string">"p値が有意水準より小さくなったので、帰無仮説を棄却し、対立仮説を採択する"</span>)
print(<span class="hljs-string">"したがって、肥料の量によって、土の種類の収量への効果が異なるといえる"</span>)
</div></code></pre>
<pre><code>p値が有意水準より小さくなったので、帰無仮説を棄却し、対立仮説を採択する
したがって、肥料の量によって、土の種類の収量への効果が異なるといえる
</code></pre>
<div style="page-break-before:always"></div>
<h3 id="python%E3%81%AB%E3%82%88%E3%82%8B%E4%BA%8C%E5%85%83%E9%85%8D%E7%BD%AE%E5%88%86%E6%95%A3%E5%88%86%E6%9E%90">Pythonによる二元配置分散分析</h3>
<p>と、ここまで結構ステップを踏んできましたが、<br>
Pythonでは簡単に分散分析表を求めることができます。</p>
<pre class="hljs"><code><div>df = pd.read_excel(<span class="hljs-string">"crop_yield.xlsx"</span>)
df.iloc[[<span class="hljs-number">0</span>,<span class="hljs-number">4</span>,<span class="hljs-number">7</span>,<span class="hljs-number">10</span>,<span class="hljs-number">13</span>,<span class="hljs-number">16</span>,<span class="hljs-number">19</span>,<span class="hljs-number">22</span>]]
</div></code></pre>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>土の種類</th>
      <th>肥料の量(g)</th>
      <th>収量(kg)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>土A</td>
      <td>100</td>
      <td>14.5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>土A</td>
      <td>200</td>
      <td>16.1</td>
    </tr>
    <tr>
      <th>7</th>
      <td>土A</td>
      <td>300</td>
      <td>19.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>土A</td>
      <td>400</td>
      <td>20.2</td>
    </tr>
    <tr>
      <th>13</th>
      <td>土B</td>
      <td>100</td>
      <td>15.3</td>
    </tr>
    <tr>
      <th>16</th>
      <td>土B</td>
      <td>200</td>
      <td>16.9</td>
    </tr>
    <tr>
      <th>19</th>
      <td>土B</td>
      <td>300</td>
      <td>20.5</td>
    </tr>
    <tr>
      <th>22</th>
      <td>土B</td>
      <td>400</td>
      <td>24.9</td>
    </tr>
  </tbody>
</table>
</div>
<div style="page-break-before:always"></div>
<pre class="hljs"><code><div>fig = interaction_plot(df[<span class="hljs-string">"肥料の量(g)"</span>], df[<span class="hljs-string">"土の種類"</span>], df[<span class="hljs-string">"収量(kg)"</span>], 
                       colors = [ <span class="hljs-string">'#FF4B00'</span>, <span class="hljs-string">'#4DC4FF'</span>],ms=<span class="hljs-number">14</span>)
plt.show()
</div></code></pre>
<p><img src="output_90_0.png" alt="png"></p>
<p>土Bの方が肥料の量の増加につれて収量の伸びが大きいことから、<br>
「交互作用効果」が確認できます。</p>
<pre class="hljs"><code><div>fig = interaction_plot(df[<span class="hljs-string">"土の種類"</span>], df[<span class="hljs-string">"肥料の量(g)"</span>], df[<span class="hljs-string">"収量(kg)"</span>],
                       colors = [ <span class="hljs-string">'#FF4B00'</span>, <span class="hljs-string">'#F6AA00'</span>, <span class="hljs-string">'#03AF7A'</span>, <span class="hljs-string">'#4DC4FF'</span>], ms=<span class="hljs-number">14</span>)
plt.show()
</div></code></pre>
<p><img src="output_92_0.png" alt="png"></p>
<p>肥料の量によって土の種類に対する収量の伸びが異なることから、<br>
「交互作用効果」が確認できます。</p>
<p>ここでPythonで二次元配置分散分析を行いたいところですが、<br>
理想の結果が得られなかったので、省略することにします。</p>

</body>
</html>
